// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var bindForm, changeRegion, changeRegionSelector, form, formSelector, loadErrorMessage, onSubmit, saveErrorMessage, submitData, url;
  loadErrorMessage = templates.filterLoadError;
  saveErrorMessage = templates.filterSaveError;
  formSelector = '#content-filter-form';
  changeRegionSelector = '#change-region';
  form = null;
  url = null;
  changeRegion = function(e) {
    var el, regionsUrl, res;
    e.preventDefault();
    el = $(this);
    regionsUrl = el.attr('href');
    res = $.get(regionsUrl);
    res.done(function(data) {
      form.replaceWith(data);
      return bindForm();
    });
    return res.fail(function() {
      return form.prepend(loadErrorMessage);
    });
  };
  submitData = function(data) {
    var res;
    res = $.post(url, data);
    res.done(function(data) {
      form.replaceWith(data);
      return bindForm();
    });
    return res.fail(function() {
      return form.prepend(saveErrorMessage);
    });
  };
  onSubmit = function(e) {
    var data;
    e.preventDefault();
    data = form.serialize();
    return submitData(data);
  };
  bindForm = function() {
    form = $(formSelector);
    url = form.attr('action');
    form.on('submit', onSubmit);
    form.parents('section').trigger('remax');
    return $(changeRegionSelector).on('click', changeRegion);
  };
  return bindForm();
})(this, this.jQuery, this.templates);
